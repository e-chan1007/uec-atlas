---
import CardBreadcrumb from "@/components/CardBreadcrumb.astro";
import Heading1 from "@/components/Heading1.astro";
import Heading2 from "@/components/Heading2.astro";
import JSONLDPreview from "@/components/JSONLDPreview.astro";
import SpatialPreviewMap from "@/components/SpatialPreviewMap.astro";
import Layout from "@/layouts/Layout.astro";
import { allJSONLD } from "@/pages/data/spatial/all";
import { formatLangString } from "@/utils/rdf";
import { expandURI } from "@/utils/url";
import { Icon } from "astro-icon/components";

export const prerender = true;

const currentId = `uatr:spatial/all`;
const fullURL = expandURI(currentId);

const breadcrumbItems = [
  { label: "Home", href: "/", icon: "mdi:home" },
  {
    label: "Spatial",
    href: "/page/spatial/",
    icon: "mdi:map",
  },
  {
    label: "all",
  },
];
---

<Layout>
  <CardBreadcrumb items={breadcrumbItems} />
  <Heading1>
    <span>すべての地理情報</span>
  </Heading1>

  <ul class="flex flex-col gap-2">
    {
      allJSONLD.features.map((feature) => (
        <li>
          <a
            class="flex flex-row items-center justify-between rounded-md p-4 hover:bg-base-200 transition-colors border border-base-300 hover:border-primary"
            href={expandURI(feature.id)}
          >
            <div class="flex flex-col gap-1">
              <h3 class="flex flex-row gap-2 items-baseline">
                <span class="font-bold">
                  {formatLangString(
                    feature.properties.name,
                    "ja",
                    "無名の地物",
                  )}
                </span>
                <span class="d-badge d-badge-primary d-badge-soft d-badge-sm">
                  {feature.properties.type}
                </span>
              </h3>
              <p class="text-xs text-base-content/70">
                {formatLangString(
                  feature.properties.name,
                  "en",
                  "Unnamed Spatial Entity",
                )}
              </p>
            </div>
            <Icon name="mdi:chevron-right" />
          </a>
        </li>
      ))
    }
  </ul>

  <div
    class="my-8 h-96 w-full border border-base-300 rounded-md overflow-hidden"
  >
    <SpatialPreviewMap
      style="width: 100%; height: 100%;"
      feature={allJSONLD as unknown as GeoJSON.Feature}
    />
  </div>

  <Heading2>JSON-LD</Heading2>

  <div class="d-join w-full mb-2">
    <input class="d-input d-join-item w-full" readonly value={fullURL} />
    <button class="d-btn d-join-item copy" data-value={fullURL}>
      <Icon name="mdi:content-copy" />
    </button>
    <a
      class="d-btn d-join-item"
      href={fullURL.replace("/resources/", "/data/")}
      target="_blank"
    >
      <Icon name="mdi:external-link" />
    </a>
  </div>

  <JSONLDPreview code={JSON.stringify(allJSONLD, null, 2)} ontology="spatial" />
</Layout>

<script>
  document.querySelector(".copy")?.addEventListener("click", (event) => {
    const button = event.currentTarget as HTMLButtonElement;
    const value = button.getAttribute("data-value");
    if (value) {
      navigator.clipboard.writeText(value);
    }
  });
</script>
